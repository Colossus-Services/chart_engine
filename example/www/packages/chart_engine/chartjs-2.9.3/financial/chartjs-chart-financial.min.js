/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.1.0
 *
 * Copyright 2020 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chartjs")):"function"==typeof define&&define.amd?define(["chartjs"],t):t((e=e||self).Chart)}(this,(function(e){"use strict";const t=(e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e).helpers,a={position:"left",ticks:{callback:e.Ticks.formatters.linear}},l=e.scaleService.getScaleConstructor("linear").extend({_parseValue(e){let t,a,l,n;return void 0!==e.c?(t=+this.getRightValue(e.l),a=+this.getRightValue(e.h),l=Math.min(t,a),n=Math.max(t,a)):(t=void 0,a=e=+this.getRightValue(e.y),l=e,n=e),{min:l,max:n,start:t,end:a}},determineDataLimits(){const e=this,a=e.chart,l=a.data.datasets,n=e.isHorizontal();e.min=null,e.max=null,t.each(l,(l,o)=>{const i=a.getDatasetMeta(o);a.isDatasetVisible(o)&&function(t){return n?t.xAxisID===e.id:t.yAxisID===e.id}(i)&&t.each(l.data,(t,a)=>{const l=e._parseValue(t);isNaN(l.min)||isNaN(l.max)||i.data[a].hidden||((null===e.min||l.min<e.min)&&(e.min=l.min),(null===e.max||e.max<l.max)&&(e.max=l.max))})});const o=.05*(e.max-e.min);e.min-=o,e.max+=o,this.handleTickRangeOptions()}});e.scaleService.registerScaleType("financialLinear",l,a);const n=e.helpers;e.defaults.financial={label:"",hover:{mode:"label"},scales:{xAxes:[{type:"time",distribution:"series",offset:!0,ticks:{major:{enabled:!0,fontStyle:"bold"},source:"data",maxRotation:0,autoSkip:!0,autoSkipPadding:75,sampleSize:100}}],yAxes:[{type:"financialLinear"}]},tooltips:{intersect:!1,mode:"index",callbacks:{label(t,a){const l=a.datasets[t.datasetIndex].data[t.index];return n.isNullOrUndef(l.y)?"O: "+l.o+"  H: "+l.h+"  L: "+l.l+"  C: "+l.c:e.defaults.global.tooltips.callbacks.label(t,a)}}}};const o=e.controllers.bar.extend({dataElementType:e.elements.Financial,_updateElementGeometry(e,t,a,l){const n=this,o=e._model,i=n._getValueScale(),r=i.getBasePixel(),s=i.isHorizontal(),c=n._ruler||n.getRuler(),d=n.calculateBarValuePixels(n.index,t,l),h=n.calculateBarIndexPixels(n.index,t,c,l),u=n.chart.data.datasets[n.index].data[t];o.horizontal=s,o.base=a?r:d.base,o.x=s?a?r:d.head:h.center,o.y=s?h.center:a?r:d.head,o.height=s?h.size:void 0,o.width=s?void 0:h.size,o.candleOpen=i.getPixelForValue(Number(u.o)),o.candleHigh=i.getPixelForValue(Number(u.h)),o.candleLow=i.getPixelForValue(Number(u.l)),o.candleClose=i.getPixelForValue(Number(u.c))},draw(){const t=this.chart.chart.ctx,a=this.getMeta().data,l=this.getDataset(),n=a.length;let o,i=0;for(e.canvasHelpers.clipArea(t,this.chart.chartArea);i<n;++i)o=l.data[i].o,null==o||isNaN(o)||a[i].draw();e.canvasHelpers.unclipArea(t)}}),i=e.helpers;function r(e){const t=e._view,a=t.width/2,l=t.x-a,n=t.x+a;return{left:l,top:t.candleHigh,right:n,bottom:t.candleLow}}e.defaults.global.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"}};const s=e.Element.extend({height(){const e=this._view;return e.base-e.y},inRange(e,t){let a=!1;if(this._view){const l=r(this);a=e>=l.left&&e<=l.right&&t>=l.top&&t<=l.bottom}return a},inLabelRange(e,t){if(!this._view)return!1;let a=!1;const l=r(this);return a=void 0!==this._view.width?e>=l.left&&e<=l.right:t>=l.top&&t<=l.bottom,a},inXRange(e){const t=r(this);return e>=t.left&&e<=t.right},inYRange(e){const t=r(this);return e>=t.top&&e<=t.bottom},getCenterPoint(){const e=this._view;return{x:e.x,y:(e.candleHigh+e.candleLow)/2}},getArea(){const e=this._view;return e.width*Math.abs(e.y-e.base)},tooltipPosition(){const e=this._view;return{x:e.x,y:(e.candleOpen+e.candleClose)/2}},hasValue(){const e=this._model;return i.isNumber(e.x)&&i.isNumber(e.candleOpen)&&i.isNumber(e.candleHigh)&&i.isNumber(e.candleLow)&&i.isNumber(e.candleClose)}}),c=e.helpers,d=e.defaults.global;d.elements.candlestick=c.merge({},[d.elements.financial,{borderColor:d.elements.financial.color.unchanged,borderWidth:1}]);const h=s.extend({draw(){const e=this._chart.ctx,t=this._view,a=t.x,l=t.candleOpen,n=t.candleHigh,o=t.candleLow,i=t.candleClose;let r,s=t.borderColor;"string"==typeof s&&(s={up:s,down:s,unchanged:s}),i<l?(r=c.getValueOrDefault(s?s.up:void 0,d.elements.candlestick.borderColor),e.fillStyle=c.getValueOrDefault(t.color?t.color.up:void 0,d.elements.candlestick.color.up)):i>l?(r=c.getValueOrDefault(s?s.down:void 0,d.elements.candlestick.borderColor),e.fillStyle=c.getValueOrDefault(t.color?t.color.down:void 0,d.elements.candlestick.color.down)):(r=c.getValueOrDefault(s?s.unchanged:void 0,d.elements.candlestick.borderColor),e.fillStyle=c.getValueOrDefault(t.color?t.color.unchanged:void 0,d.elements.candlestick.color.unchanged)),e.lineWidth=c.getValueOrDefault(t.borderWidth,d.elements.candlestick.borderWidth),e.strokeStyle=c.getValueOrDefault(r,d.elements.candlestick.borderColor),e.beginPath(),e.moveTo(a,n),e.lineTo(a,Math.min(l,i)),e.moveTo(a,o),e.lineTo(a,Math.max(l,i)),e.stroke(),e.fillRect(a-t.width/2,i,t.width,l-i),e.strokeRect(a-t.width/2,i,t.width,l-i),e.closePath()}});e.defaults.candlestick=e.helpers.merge({},e.defaults.financial),e.defaults._set("global",{datasets:{candlestick:e.defaults.global.datasets.bar}});e.controllers.candlestick=o.extend({dataElementType:h,updateElement(e,t,a){const l=this,n=l.getMeta(),o=l.getDataset(),i=l._resolveDataElementOptions(e,t);e._xScale=l.getScaleForId(n.xAxisID),e._yScale=l.getScaleForId(n.yAxisID),e._datasetIndex=l.index,e._index=t,e._model={datasetLabel:o.label||"",color:o.color,borderColor:o.borderColor,borderWidth:o.borderWidth},l._updateElementGeometry(e,t,a,i),e.pivot()}});const u=e.helpers,m=e.defaults.global;m.elements.ohlc=u.merge({},[m.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}]);const g=s.extend({draw(){const e=this._chart.ctx,t=this._view,a=t.x,l=t.candleOpen,n=t.candleHigh,o=t.candleLow,i=t.candleClose,r=u.getValueOrDefault(t.armLengthRatio,m.elements.ohlc.armLengthRatio);let s=u.getValueOrDefault(t.armLength,m.elements.ohlc.armLength);null===s&&(s=t.width*r*.5),e.strokeStyle=i<l?u.getValueOrDefault(t.color?t.color.up:void 0,m.elements.ohlc.color.up):i>l?u.getValueOrDefault(t.color?t.color.down:void 0,m.elements.ohlc.color.down):u.getValueOrDefault(t.color?t.color.unchanged:void 0,m.elements.ohlc.color.unchanged),e.lineWidth=u.getValueOrDefault(t.lineWidth,m.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(a,n),e.lineTo(a,o),e.moveTo(a-s,l),e.lineTo(a,l),e.moveTo(a+s,i),e.lineTo(a,i),e.stroke()}});e.defaults.ohlc=e.helpers.merge({},e.defaults.financial),e.defaults._set("global",{datasets:{ohlc:{barPercentage:1,categoryPercentage:1}}});e.controllers.ohlc=o.extend({dataElementType:g,updateElement(e,t,a){const l=this,n=l.getMeta(),o=l.getDataset(),i=l._resolveDataElementOptions(e,t);e._xScale=l.getScaleForId(n.xAxisID),e._yScale=l.getScaleForId(n.yAxisID),e._datasetIndex=l.index,e._index=t,e._model={datasetLabel:o.label||"",lineWidth:o.lineWidth,armLength:o.armLength,armLengthRatio:o.armLengthRatio,color:o.color},l._updateElementGeometry(e,t,a,i),e.pivot()}})}));
